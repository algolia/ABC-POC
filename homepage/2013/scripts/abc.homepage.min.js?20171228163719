/*!
 *
 * ABC Homepage
 *
 */
var abcContentProfile="homepage",popup=null,debug=!1,ABC=ABC||{};ABC.Homepage=function(a){function b(b,c){var d=a(b.getElementsByTagName("h3")[0]),e=parseInt(d.height()),f=parseInt(d.css("font-size")),g=0===c?55:63,h=13,i=d.parent().parent().attr("data-short-title"),j=0,k=10;for(c>0&&i&&e>g&&(d.text(i),e=parseInt(d.height()),debug&&console.log("hero "+(c+1)+": title swapped for short teaser"));e>g&&f>h&&c<k;)f--,d.css("font-size",f+"px"),e=parseInt(d.height()),j++;debug&&console.log("hero "+(c+1)+": textHeight: "+e+", maxTextHeight: "+g+", fontSize: "+f+" (-"+j+"px)")}function c(b){var c=a(b.getElementsByTagName("p")[0]);c.text().indexOf("…")!=-1&&c.html(c.text()+" <b>More</b>")}function d(){"true"==a("#favourites").attr("aria-hidden")?(a("#favourites").attr("aria-hidden",!1).slideDown(300,"swing"),a("#editFavourites a").addClass("on").html("Close<span> Favourites Topics</span>")):(a("#favourites").attr("aria-hidden",!0).slideUp(300,"swing"),a("#editFavourites a").removeClass("on").html("<span>Edit </span>Favourite Topics"))}function e(a){for(var b,c=a.parentNode,d=c.id;(""===d||"editableLinks"===d)&&(c=c.parentNode,d=c.id,"BODY"!==c.nodeName););a.setAttribute("data-wt.z_ca",c.id),b=a.href?a.href===window.location+a.hash?a.hash:"localhost.abc.net.au"===a.hostname||"wwwdev.abc.net.au"===a.hostname||"www.abc.net.au"===a.hostname?a.href.split("/")[3]:"javascript:"===a.protocol?a.textContent||a.innerText:a.hostname:a.textContent||a.innerText,a.setAttribute("data-wt.z_dest",b)}function f(){var b=a("#searchQuery").val().replace(/^\s+|\s+$/g,"");return b?(a("#searchQuery").attr("value",b),!0):(location.href="http://search.abc.net.au/search/search.cgi?collection=abcall_meta",!1)}function g(a){var b,c=new Date(a),d=new Date,e=(d-c)/1e3,f=["second","minute","hour","day","week","month","year","decade","century","millenium"],g=["seconds","minutes","hours","days","weeks","months","years","decades","centuries","millenia"],h=[1,60,60,24,7,4.345,12,10,10,10],i="",j="",k=0;if(isNaN(e))return"";if(Math.abs(e)<1)return"now";for(;Math.abs(Math.round(e))>=h[k+1]&&k<h.length;)e/=h[++k];return e<0&&(i="in "),e>0&&(j=" ago"),b=Math.abs(Math.round(e))>1?g[k]:f[k],i+Math.abs(Math.round(e))+" "+b+j}function h(){a(".justin time").each(function(b){a(this).attr("data-datetimeRFC2822")&&a(this).html(g(a(this).attr("data-datetimeRFC2822")))}),window.timestampsTimer=setTimeout(h,6e4)}function i(){a.ajax({url:"/homepage/2013/contentdata/wallace/promo.htm",dataType:"html",cache:!0,success:function(b){a("#abcPromo").html(b),debug&&console.log("Loading fallback promo.")},error:function(){debug&&console.log("Error loading fallback promo.")}})}function j(b){debug&&console.log(a(b).attr("href")),a(a(b).attr("href")).attr("tabindex",-1).on("blur focusout",function(){a(this).removeAttr("tabindex")}).focus()}return{init:function(){a("#skiplinks a").click(function(a){j(this)}),a(".platform-switch a").click(function(){ABC.Platforms.setPref(ABC.Platforms.FORMFACTOR.MOBILE)}),a("#hero > .article").each(function(a){b(this,a),c(this)}),a("#search").submit(function(){f()}),a("#editFavourites a, .closeFavourites").click(function(a){d(),a.preventDefault()}),a('a[href="#explore"]').click(function(b){a("html,body").animate({scrollTop:a(a(this).attr("href")).offset().top},800,function(){j(this)})}),a('a[href="#hostpicks"]').click(function(b){a("html,body").animate({scrollTop:a(a(this).attr("href")).offset().top},800,function(){j(this)})}),h(),"undefined"!=typeof googletag&&googletag.cmd?(googletag.cmd.push(function(){googletag.display("abcPromo")}),googletag.cmd.push(function(){googletag.display("shopPromo")})):i(),a("a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},setWebtrendsLinkParameters:e,fixFocus:j}}(jQuery),ABC.Homepage.Favourites=function(a){function b(a){for(var b=m.length,c=0;c<b;c++)if(m[c].getAttribute("data-name")===a)return m[c];return null}function c(a){var c=b(a);return c?(c=c.firstChild.textContent||c.firstChild.innerText,c=c.replace(/portal/gi,""),/ABC TV/.test(c)||/ABC RN/.test(c)||(c=c.replace(/ABC (\D)/g,"$1")),c=c.replace(/Grandstand Sport/g,"Sport"),c=c.replace(/Technology \+ Games/g,"Tech + Games"),c=c.replace(/Health \& Wellbeing/g,"Health"),c=c.replace(/Local Radio/g,"Local")):""}function d(a){var c=b(a);return c?c.getAttribute("data-href"):""}function e(a){for(var b=0;b<l.length;b++)if(l[b]===a)return b;return-1}function f(){for(var c=0;c<m.length;c++)a(m[c]).removeClass("on"),a(m[c]).find("input:checkbox").prop("checked",!1);for(c=0;c<l.length;c++)b(l[c])&&(a(b(l[c])).addClass("on"),a(b(l[c])).find("input:checkbox").prop("checked",!0));g()}function g(){var b=null,e=null;a(".editable").remove();for(var f=0;f<l.length;f++)b=d(l[f]),e=c(l[f]),e&&b&&a("#editFavourites").before('<li class="editable"><a href="'+b+'">'+e+"</a></li>");a(".editable a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})}function h(){localStorageAvailable?localStorage.setItem(j,JSON.stringify(l)):ABC.Storage.Cookies.set(j,JSON.stringify(l),{expires:365,domain:".abc.net.au",path:"/"})}function i(){return l=k.slice(),f(),localStorageAvailable?localStorage.removeItem(j):ABC.Storage.Cookies.remove(j,{domain:".abc.net.au",path:"/"}),!1}var j="ABC_Homepage_Favourites",k=["sport","localradio","science","health","triplej","radionational","splash"],l=[],m=[];return{init:function(){ABC.Storage.Cookies.get(j)?(l=JSON.parse(ABC.Storage.Cookies.get(j)),localStorageAvailable&&(localStorage.setItem(j,JSON.stringify(l)),ABC.Storage.Cookies.remove(j,{domain:".abc.net.au",path:"/"}))):l=localStorageAvailable?JSON.parse(localStorage.getItem(j))||k.slice():k.slice(),m=a("#favourites li"),f(),a("#favourites li input").change(function(b){var c=this.parentNode.parentNode;a(this).prop("checked")?(l.push(c.getAttribute("data-name")),a(c).addClass("on")):(l.splice(e(c.getAttribute("data-name")),1),a(c).removeClass("on")),g(),h()}),a("#favourites li input").focus(function(b){a(this.parentNode.parentNode).addClass("focus")}),a("#favourites li input").blur(function(b){a(this.parentNode.parentNode).removeClass("focus")}),a(".resetFavourites").click(function(){return i()})}}}(jQuery),ABC.Homepage.Weather=function(a){function b(b){var d=a(".hasLocation .details"),e=b.wz_location;d.find("h2").html(e.conditions.temp_c.val+"°C"),d.find("p").html(e.forecasts.forecast[0].temp_min_c.val+"&ndash;"+e.forecasts.forecast[0].temp_max_c.val+"°"),d.find(".weather-icon").html(e.forecasts.forecast[0].icon),d.find(".weather-icon").attr("class","weather-icon "+e.forecasts.forecast[0].icon),a(".weather .hasLocation .yourLocation").html(ABC.Homepage.Location.userProfile.Suburb),e.warnings&&debug&&c(e.warnings)}function c(b){console.log(b);var c=a(".hasLocation .location"),d=f.find(".warningBox"),e="";c.find(".warning a");$.isArray(b)||(b=[b]),c.find(".warning").show().find("a").html("<span>"+b.length+"</span> warning"+(1==b.length?"":"s"));for(var g=0;g<b.length;g++){var h=b[g].warning,i="<div class='warningItem'>";i+="<h3><a href='#' class='expander'><strong>"+h.issue_day_name+"</strong> - "+h.short_text+"</a></h3>",i+="<div class='longDesc'>",i+=h.long_text,i+="<p class='emergencyLink'>Go to <a href='/news/emergency/'>ABC Emergency</a></p>",i+="</div> <!-- end of longDesc --></div></div><!-- end of warning -->",e+=i}c.find("a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)}),d.find(".warningInfo").html(e),a(".warning a, #weatherWarnings a.closeBtn").unbind("click").click(function(b){"true"==a("#weatherWarnings").attr("aria-hidden")?a("#weatherWarnings").attr("aria-hidden",!1).fadeIn(300):a("#weatherWarnings").attr("aria-hidden",!0).fadeOut(300),b.preventDefault()}),d.find(".warningItem").each(function(){a(this).find(".expander").click(function(){return a(this.parentNode).next().slideToggle(300),!1})})}function d(b){var c,d,e,f=a(".hasLocation .forecastBox"),g=b.wz_location.forecasts.forecast;for(c=0;c<7;c++)d=g[c],e="",d?(e+="<div class='dayDesc'>",e+=0===c?"<h3>"+ABC.Homepage.Location.userProfile.Suburb+" Today</h3>":"<h3>"+d.day_name+"</h3>",e+="<p>"+d.icon+"</p>",e+="<p>"+d.prob_precip+"% chance of rain</p>",e+="</div>",e+="<div class='icon "+d.icon+"'></div>",e+="<div class='tempRange'>",0===c?(e+="<p class='current'>"+b.wz_location.conditions.temp_c.val+"°</p>",e+="<p class='range'>"+d.temp_min_c.val+"&ndash;"+d.temp_max_c.val+"°</p>"):(e+="<p class='max'>"+d.temp_max_c.val+"°</p>",e+="<p class='min'><span>min</span> "+d.temp_min_c.val+"°</p>"),e+="</div>"):e="<p class='error'>No forcast data available</p>",f.find(".forecastDay:eq("+c+")").html(e);a(".forecastDay a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})}var e="/dat/weather/forecasts/v1/",f=a(".weather"),g=null;return{init:function(){var b=this.checkWeatherLocation();b&&this.getWeatherData(ABC.Homepage.Location.userProfile,ABC.Homepage.Weather.updateWeatherInformation),$("body").on("profileChanged",function(a,b){ABC.Homepage.Weather.getWeatherData(b,ABC.Homepage.Weather.updateWeatherInformation)}),a("body").on("profileRemoved",function(a,b){ABC.Homepage.Weather.checkWeatherLocation()})},checkWeatherLocation:function(){return ABC.Homepage.Location.userProfile.ID?g?(ABC.Homepage.Weather.openErrorPanel(g),!1):(ABC.Homepage.Weather.openHasLocationPanel(),!0):(ABC.Homepage.Weather.openNoLocationPanel(),!1)},openNoLocationPanel:function(){f.find(".noLocation").show().siblings().hide()},openHasLocationPanel:function(){f.find(".hasLocation").show().siblings().hide(),a("a.openForecast, #weatherForecast a.closeBtn").unbind("click").click(function(b){"true"==a("#weatherForecast").attr("aria-hidden")?a("#weatherForecast").attr("aria-hidden",!1).fadeIn(300):a("#weatherForecast").attr("aria-hidden",!0).fadeOut(300),b.preventDefault(),b.stopPropagation()})},openErrorPanel:function(a){var b=f.find(".locationError");b.find(".error").html(a),b.show().siblings().hide()},getWeatherData:function(b,c){function d(b){return b===-1?(g="No weather data is collected at this location.",void ABC.Homepage.Weather.openErrorPanel(g)):void a.ajax({url:e+b+".json",dataType:"json",success:function(a){"function"==typeof c&&(g=null,c(a))},error:function(a){g="Local weather station data is currently not available.",ABC.Homepage.Weather.openErrorPanel(g)}})}var f=b.Suburb.replace(/^\s+|\s+$/g,"").toLowerCase().replace(/\s/g,"-"),h=b.Postcode.replace(/^\s+|\s+$/g,""),i=e+"region/"+f+"-"+h+".json";a.ajax({url:i,dataType:"json",success:function(a){var b=a.local_weather.wz.code;d(b)},error:function(a){g="We could not find station data for this region.",ABC.Homepage.Weather.openErrorPanel(g)}})},updateWeatherInformation:function(a){b(a),d(a),ABC.Homepage.Weather.openHasLocationPanel()}}}(jQuery),ABC.Homepage.Location=function(a){var b="",c="/cgi-bin/locationcentral/postcodesuburblookup.pl",d=!!navigator.geolocation,e="ABC_Homepage_Location",f=null;return{defaultUser:{Suburb:null,State:null,ID:null,Postcode:null,Region:null,StateAbbreviation:null,Country:null,RecentLocations:[]},userProfile:{Suburb:null,State:null,ID:null,Postcode:null,Region:null,StateAbbreviation:null,Country:null,RecentLocations:[]},isRecentLocation:function(a,b){for(var c=0;c<b.length;c++)if(a.ID===b[c].ID)return!0;return!1},updateUserProfile:function(b){var c=a.extend(!0,{},this.defaultUser,b),d=b,f=this.userProfile.RecentLocations;this.isRecentLocation(d,f)||(f.unshift(d),f.length>3&&f.pop()),c.RecentLocations=f,this.userProfile=c,localStorageAvailable?localStorage.setItem(e,JSON.stringify(this.userProfile)):ABC.Storage.Cookies.set(e,JSON.stringify(this.userProfile),{expires:365,domain:".abc.net.au",path:"/"}),this.addRecentLocationsList(a(".recentLocations ul")),a("body").trigger("profileChanged",this.userProfile),setTimeout(function(){ABC.Homepage.Location.closeSetLocationBox()},200)},changeLocationAttribute:function(b){this.userProfile=a.extend(!0,{},this.userProfile,b),this.userProfile.RecentLocations.length>0&&(this.userProfile.RecentLocations[0]=a.extend(!0,{},this.userProfile.RecentLocations[0],b)),a("body").trigger("profileAttributeChanged",b)},removeProfile:function(){this.userProfile=this.defaultUser,this.userProfile.RecentLocations=[],localStorageAvailable?localStorage.removeItem(e):ABC.Storage.Cookies.remove(e,{domain:".abc.net.au",path:"/"}),a("body").trigger("profileRemoved",this.userProfile),a("#setLocation .recentLocations ul").empty(),a("#setLocation .remove-location").css("display","none"),ABC.Homepage.Location.closeSetLocationBox()},getCurrentLocation:function(c){function e(d){a.ajax({url:b,data:{Latitude:d.coords.latitude,Longitude:d.coords.longitude,noSuburbs:1},type:"POST",success:function(a){"function"==typeof c&&c(a)},error:function(a){"function"==typeof c&&c(a)}})}if(d){navigator.geolocation.getCurrentPosition(e)}else"function"==typeof c&&c(void 0)},getGeolocation:function(a){d&&"function"==typeof a&&navigator.geolocation.getCurrentPosition(a)},addLocationAutocomplete:function(b,d,e){var f=b.parent(),g=f.find("label[for='"+b.attr("id")+"']"),h=g.text();f.on("submit",function(a){a.preventDefault()}),b.autocomplete({minLength:2,source:function(d,e){b.addClass("loading"),f.off("submit.autocomplete"),g.text(h).removeClass("highlight"),a.ajax({url:c,dataType:"json",data:{"if":d.term},success:function(c){1===c.PostcodeSuburbs.length?f.one("submit.autocomplete",function(){ABC.Homepage.Location.updateUserProfile(c.PostcodeSuburbs[0]),b.autocomplete("close")}):c.PostcodeSuburbs.length>0?f.one("submit.autocomplete",function(){g.text("Select a location from the list below").addClass("highlight")}):c.PostcodeSuburbs=[{ID:"unknown",Postcode:"",Suburb:"No match found",State:null,StateAbbreviation:"",Country:null,Region:null}],e(a.map(c.PostcodeSuburbs,function(a){var b;return b="unknown"===c.PostcodeSuburbs[0].ID?"No match found":a.Suburb+", "+a.StateAbbreviation+" "+a.Postcode,{label:b,value:a}})),b.removeClass("loading")},error:function(a){b.removeClass("loading")}})},select:function(a,c){return"unknown"!==c.item.value.ID&&(ABC.Homepage.Location.updateUserProfile(c.item.value),"function"==typeof d&&d(c.item,e)),b.val(""),!1},focus:function(a,c){return"unknown"!==c.item.value.ID&&b.val(c.item.label),!1},close:function(){f.off("submit.autocomplete"),g.text(h).removeClass("highlight")}})},addRecentLocationsList:function(b,c,d){var e,f="",g=ABC.Homepage.Location.userProfile.RecentLocations;for(e=0;e<g.length;e++)f+='<li><a href="">'+g[e].Suburb+"</a></li>";b.html(f),g.length>0&&a("#setLocation .remove-location").css("display","inline"),b.find("li a").bind("click",function(){var b=a(this).parent(),e=b.parent().children().index(b),f=g[e];return ABC.Homepage.Location.updateUserProfile(f),"function"==typeof c&&c.call(d),!1})},openSetLocationBox:function(b){f=b,dialog=document.getElementById("setLocation"),a("#setLocation").attr("aria-hidden","false").show(),a("#modalOverlay").show(),a("#skiplinks, #abcHeader, .abcSiteHeader, #mainContent, #footer, #abcFooter").attr("aria-hidden","true").addClass("blur"),dialog.tabIndex=-1,dialog.focus(),a(":root").focusin(function(b){"false"!=a("#setLocation").attr("aria-hidden")||a.contains(document.getElementById("setLocation"),b.target)||(b.stopPropagation(),dialog.focus())})},closeSetLocationBox:function(){var b=f;if(a("#setLocation").attr("aria-hidden","true").hide(),a("#modalOverlay").hide(),a("#skiplinks, #abcHeader, .abcSiteHeader, #mainContent, #footer, #abcFooter").attr("aria-hidden","false").removeClass("blur"),"radioLocationSelector"==f.parentNode.id)f.focus();else{for(;b.parentNode&&"weather"!=b.parentNode.id&&"local"!=b.parentNode.id;)b=b.parentNode;"block"==a(b).css("display")?f.focus():a(b).siblings(":visible").first().find('a[href="#setLocation"]').focus()}},init:function(){a.Event("profileChanged"),a.Event("profileAttributeChanged"),a.Event("profileRemoved");ABC.Storage.Cookies.get(e)?(this.userProfile=JSON.parse(ABC.Storage.Cookies.get(e)),this.addRecentLocationsList(a(".recentLocations ul")),localStorageAvailable&&(localStorage.setItem(e,JSON.stringify(this.userProfile)),ABC.Storage.Cookies.remove(e,{domain:".abc.net.au",path:"/"}))):localStorageAvailable&&localStorage.getItem(e)&&(this.userProfile=JSON.parse(localStorage.getItem(e)),this.addRecentLocationsList(a(".recentLocations ul"))),this.addLocationAutocomplete(a(".setLocation .autocomplete input[type='text']"),function(){}),a('a[href$="#setLocation"]').click(function(a){ABC.Homepage.Location.openSetLocationBox(this),a.preventDefault()}),a("#setLocation a.closeBtn").click(function(a){ABC.Homepage.Location.closeSetLocationBox(),a.preventDefault()}),a("#setLocation").keypress(function(a){27==a.keyCode&&ABC.Homepage.Location.closeSetLocationBox()}),a("#setLocation .remove-location").click(function(a){ABC.Homepage.Location.removeProfile(),a.preventDefault()})}}}(jQuery),ABC.Homepage.Local=function(a){var b="/homepage/2013/contentdata/xmlengine/local/top-stories/";!!navigator.geolocation;return{init:function(){ABC.Homepage.Location.userProfile.Region&&(ABC.Homepage.Local.setLocation(),ABC.Homepage.Local.updateNews()),a("body").on("profileChanged",function(a,b){ABC.Homepage.Local.setLocation(),ABC.Homepage.Local.updateNews()}),a("body").on("profileRemoved",function(a,b){ABC.Homepage.Local.removeLocation()})},setLocation:function(){var b=a("#local"),c=b.find(".hasLocation"),d=ABC.Homepage.Location.userProfile;c.find(".yourLocation strong").html(d.Suburb.replace(/\+/g," ")),c.find("h4:first").html("Change location"),a("#local .localMore").html('<a href="http://www.abc.net.au/news/'+d.Region+'/">More Local News</a>'),c.show().siblings().hide(),a("#local a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},removeLocation:function(){var b=a("#local");b.find("dd:first strong").empty(),b.find(".yourLocation strong").empty(),b.find("dd:last a").empty(),b.find(".localMore").empty(),b.find(".article").empty(),a("#local .noLocation").css("display","block").siblings().css("display","none")},updateNews:function(){var c=ABC.Homepage.Location.userProfile,d=a("#local"),e=d.find(".article"),f=d.find("a.set-location:last"),g="";a.ajax({url:b+c.Region+".json",dataType:"json",success:function(b){g+="<div data-wallaceid='"+b["local-news"].article["data-wallaceid"]+"'>",g+="<a href="+b["local-news"].article.publishurl+">",g+="<h3>"+b["local-news"].article.title+"</h3>",g+="<p>"+b["local-news"].article.description+"</p>",g+="</a></div>",e.html(g),c.LocalRadioStation=b["local-news"]["meta-data"]["station-name"],d.find(".localRadio a").attr("href","http://www.abc.net.au/"+c.Region).html(c.Region),a(".stations .localradio > a").text(c.LocalRadioStation),f.not(":hidden")&&f.addClass("hidden"),a("#local a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},error:function(a){g+="<p>We could not find a news story for this location.</p>",e.html(g),d.find(".localRadio a").attr("href","http://www.abc.net.au/"+c.Region).html(c.Region),f.not(":hidden")&&f.addClass("hidden")}})}}}(jQuery),ABC.Homepage.Highlights=function(a){function b(b){var c,d=b.length<8?b.length:8;a("#iviewHighlights").append('<h2 class="tabHeading">iview Highlights</h2><div class="abcRow streamingLinks">\t<a class="abcSpan6 watchABClive" href="http://iview.abc.net.au/programs/abc-live-stream/IV1512H001S00"><span>Watch ABC Live on iview</span></a>\t<a class="abcSpan6 watchNews24live" href="http://iview.abc.net.au/programs/abc-news-24/NS1413V001S00"><span>Watch NEWS Live on iview</span></a></div><div class="iviewHighlightsRow abcRow"></div>');for(var e=0;e<d;e++)c=b[e],a(".iviewHighlightsRow").append('<div class="n'+(e+1)+' article abcSpan3"><a href="http://iview.abc.net.au/'+c.href+'"><img src="'+c.thumbnail.replace(/thumbs\/i/,"thumbs/220")+'" alt="" /><h3>'+c.seriesTitle+"</h3>"+(c.title?"<h4>"+c.title+"</h4>":"")+"<p>"+c.description+"</p></a></div>");a("#iviewHighlights a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})}function c(a,b){a==ABC.Homepage.Location.userProfile.State?(k=null,localStorageAvailable?localStorage.removeItem(m):ABC.Storage.Cookies.remove(m,{domain:".abc.net.au",path:"/"})):(k={},k.State=a,k.StateAbbreviation=b,localStorageAvailable?localStorage.setItem(m,JSON.stringify(k)):ABC.Storage.Cookies.set(m,JSON.stringify(k),{expires:365,domain:".abc.net.au",path:"/"})),e()}function d(){function b(b,c){a(b).each(function(b){a(this).height()>d[c]&&(d[c]=a(this).height())})}for(var c,d=[],e=7;e<=11;e++)d[e]=0,c=".t"+e,b(c,e),a(c).css("min-height",d[e])}function e(){var b,c;ABC.Storage.Cookies.get(m)?(k=JSON.parse(ABC.Storage.Cookies.get(m)),localStorageAvailable&&(localStorage.setItem(m,JSON.stringify(k)),ABC.Storage.Cookies.remove(m,{domain:".abc.net.au",path:"/"}))):localStorageAvailable&&(k=JSON.parse(localStorage.getItem(m))),k?(b=k.State,c="/"+k.StateAbbreviation,"/netw"==c&&(c="")):ABC.Homepage.Location.userProfile&&ABC.Homepage.Location.userProfile.State?(b=ABC.Homepage.Location.userProfile.State,c="/"+ABC.Homepage.Location.userProfile.StateAbbreviation.toLowerCase()):(b="National",c=""),debug&&console.log("Getting TVEPG for "+b),a.ajax({url:"/homepage/2013/contentdata/xmlengine/tvepg"+c+"/abc1.htm",dataType:"html",cache:!0,success:function(e){debug&&console.log("Loading "+c+"/abc1.htm"),a("#epg_abc1").html(e),a("#tvRegionSelector option").each(function(){this.selected=!1,this.selected=this.text===b}),d(),a("#epg_abc1 a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},error:function(){debug&&console.log("Error getting ABC1 EPG for "+b)}}),a.ajax({url:"/homepage/2013/contentdata/xmlengine/tvepg"+c+"/abcnews24.htm",dataType:"html",cache:!0,success:function(b){debug&&console.log("Loading "+c+"/abcnews24.htm"),a("#epg_abcnews24").html(b),d(),a("#epg_abcnews24 a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},error:function(){debug&&console.log("Error getting ABCNEWS24 EPG for "+b)}})}function f(){var b;ABC.Homepage.Location.userProfile&&ABC.Homepage.Location.userProfile.Region?(b=ABC.Homepage.Location.userProfile.Region,a("#radioRegion").text(ABC.Homepage.Location.userProfile.Suburb),a(".stations .localradio h4 a").attr("href","http://www.abc.net.au/"+b+"/"),a(".stations .localradio h4 a").text(ABC.Homepage.Location.userProfile.LocalRadioStation),a(".stations .localradio h4 a").attr("style",'background-image: url("/homepage/2013/styles/img/local/'+b+'.png")'),a(".stations .localradio a.listenLive").attr("href","https://radio.abc.net.au/stations/local_"+b+"/live?play=true"),a(".stations .localradio a.listenLive").removeClass("listenLiveAlt"),a(".stations .localradio a.visitWebsite").attr("href","http://www.abc.net.au/"+b+"/"),debug&&console.log("Setting local radio to "+b)):(a("#radioRegion").text("Not set"),a(".stations .localradio h4 a").attr("href","http://www.abc.net.au/local/"),a(".stations .localradio h4 a").text("ABC Local Radio"),a(".stations .localradio h4 a").attr("style",""),a(".stations .localradio a.listenLive").attr("href",""),a(".stations .localradio a.listenLive").addClass("listenLiveAlt"),a(".stations .localradio a.visitWebsite").attr("href","http://www.abc.net.au/local/"),debug&&console.log("Setting local radio to none")),a(".stations .localradio .listenLive").click(function(){a(this).attr("target","listenLive")}),a(".stations .localradio a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})}function g(){l.tvHighlights!==!0&&(l.tvHighlights=!0,a.ajax({url:"/homepage/2013/components/highlights-tv.htm",dataType:"html",cache:!0,success:function(b){debug&&console.log("Loading TV highlights"),a("#tvHighlights").html(b),a("#tvHighlights a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},error:function(){debug&&console.log("Error loading TV highlights")}}))}function h(){l.tvEPG!==!0&&(l.tvEPG=!0,a.ajax({url:"/homepage/2013/components/tvTonight.htm",dataType:"html",cache:!0,success:function(b){debug&&console.log("Loading TV Tonight"),a("#tvTonight").html(b),e(),a("#tvRegionSelector").change(function(b){c(a("#tvRegionSelector option:selected").text(),a(this).val())}),a("body").on("profileChanged profileRemoved",function(a,b){e()}),a("#tvTonight a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},error:function(){debug&&console.log("Error loading TV Tonight")}}))}function i(c){"undefined"==typeof c&&(c=!1),l.iviewHighlights===!0&&c===!1||(l.iviewHighlights=!0,ABC.Recommendations&&!c||a.ajax({url:"http://iview.abc.net.au/api/featured/?callback=onIviewItemsLoaded",dataType:"jsonp",cache:!0,jsonpCallback:"onIviewItemsLoaded",success:function(a){debug&&console.log("Loading iview highlights"),b(a)},error:function(){debug&&console.log("Error loading iview highlights")}}))}function j(){l.radioHighlights!==!0&&(l.radioHighlights=!0,a.ajax({url:"/homepage/2013/components/highlights-radio.htm",dataType:"html",cache:!0,success:function(b){debug&&console.log("Loading radio highlights"),a("#radioHighlights").html(b),f(),a("body").on("profileChanged profileRemoved",function(a,b){f()}),a(".listenLive").click(function(){a(this).attr("target","listenLive")}),a('#radioHighlights a[href$="#setLocation"]').click(function(a){ABC.Homepage.Location.openSetLocationBox(this),a.preventDefault()}),a("#radioHighlights a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})},error:function(){debug&&console.log("Error loading radio highlights")}}))}var k,l={tvHighlights:!1,tvEPG:!1,iviewHighlights:!1,radioHighlights:!1},m="ABC_Homepage_TV_Region";return{init:function(){var b=function(){a(window).scrollTop()+a(window).height()>a("#ourpicks").offset().top&&(g(),i()),a(window).scrollTop()+a(window).height()>a("#tvHighlights").offset().top&&(j(),h(),a(window).off("scroll",b))};b(),a(window).on("scroll",b)},loadiviewHighlights:i}}(jQuery),jQuery(document).ready(function(){ABC.Homepage.Location.init(),ABC.Homepage.init(),ABC.Homepage.Favourites.init(),ABC.Homepage.Weather.init(),ABC.Homepage.Local.init(),ABC.FUNNELBACK.initializeQueryCompletion()}),jQuery(window).load(function(){ABC.Homepage.Highlights.init()}),window.console||(window.console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}});var localStorageAvailable=function(){var a,b=(new Date).getTime();try{return localStorage.setItem(b,b),a=localStorage.getItem(b)==b,localStorage.removeItem(b),a}catch(c){return!1}}();