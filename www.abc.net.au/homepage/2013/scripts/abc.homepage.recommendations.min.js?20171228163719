!function(){function a(a,b){return a.length>b?a.substring(0,b)+"...":a}function b(a,b){if(a){var c=a.match(/\/thumbs\/[a-zA-Z0-9](.*)/);if(c)return"//cdn.iview.abc.net.au/thumbs/"+b+c[1]}return a}function c(a){if(a){var b=a.match(/\/rimage\/([a-zA-Z0-9]*).*\.([0-9a-z]*)/);if(b)return"//abc.net.au/cm/rimage/"+b[1]+"-16x9-small."+b[2]}return!1}function d(a,b){if(a){var c="https://iview.abc.net.au/api/programs/"+a;$.ajax({url:c,dataType:"json",timeout:4e3}).success(function(a){a.eitherTitle=a.seriesTitle||a.title,b(!1,a)}).error(function(a){b(a,!1)})}}function e(a){var b=a;"object"!=typeof a&&(b=new Date(a));var c,d=Math.floor((new Date-b)/1e3),e=Math.floor(d/31536e3);return e>=1?c="year":(e=Math.floor(d/2592e3),e>=1?c="month":(e=Math.floor(d/86400),e>=1?c="day":(e=Math.floor(d/3600),e>=1?c="hour":(e=Math.floor(d/60),e>=1?c="minute":(e=d,c="second"))))),(e>1||0===e)&&(c+="s"),e+" "+c}ABC.Recommendations.init({apikey:"160b7304-f905-4a5b-93cd-9df80bf19484"}),$("#newsjustin").addClass("recommendations-loading"),ABC.Recommendations.fetchModule({moduleid:"abc-homepage-news-justin",modulecontext:"null",containerSelector:"#newsjustin",itemSelector:".article",timeout:5e3}).then(function(a){var b=a.recommendations.length;if(b>0){var c=0;$(a.recommendations).each(function(b,d){if(d.metadata){if(c<1){var f=$('#skiplinks a[href$="newsjustin"]').first();f.text(a.modulelabel);var g='<div id="newsjustin" class="section justin layout-rows recommendations-loaded"><h2>'+a.modulelabel+"</h2><ul></ul><hr></div>";$("#newsjustin").replaceWith(g)}var h=d.metadata,i='<li class="article"><a href="'+h.canonicalURL+'">'+h.titleAlt.md+'<span class="time"><time class="updated" datetime="'+h.dates.published+'" data-datetimerfc2822="'+h.dates.published+'">'+e(h.dates.published)+"</time></span></a></li>";$("#newsjustin ul").append(i),c++}}),$("#newsjustin .article a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)}),ABC.Recommendations.applyTracking({containerSelector:"#newsjustin",itemSelector:".article"},a)}else a.snowplow.contentsource="unknown",a.snowplow.contenttype="unknown",ABC.Recommendations.applyTracking({containerSelector:"#newsjustin",itemSelector:".article"},a)})["catch"](function(a){console.error(a)}).then(function(){$("#newsjustin").removeClass("recommendations-loading")}),$(".abcSpan3.mostwatched.layout-blocklist h3").addClass("recommendations-loading"),ABC.Recommendations.fetchModule({moduleid:"abc-homepage-whats-popular-watched",modulecontext:"null",containerSelector:".abcSpan3.mostwatched.layout-blocklist",itemSelector:"ol > li",timeout:5e3}).then(function(a){var b=a.recommendations.length;if(b>0){var c=($(".abcSpan3.mostwatched.layout-blocklist").clone(),'<div id="whatspopularwatched" class="abcSpan3 mostwatched layout-blocklist recommendations-loaded"><h3 class="recommendations-loading">'+a.modulelabel+"</h3><ol></ol></div>");$(".abcSpan3.mostwatched.layout-blocklist").replaceWith(c),$.each(a.recommendations,function(a,b){var c=b.metadata,d='<li><a href="'+c.canonicalURL+'"><strong>Watch</strong>'+c.media.video.program.title+"<cite>"+c.title+"</cite></a></li>";$("#whatspopularwatched ol").append(d)}),ABC.Recommendations.applyTracking({containerSelector:"#whatspopularwatched",itemSelector:"ol > li"},a)}else a.snowplow.contentsource="unknown",a.snowplow.contenttype="unknown",ABC.Recommendations.applyTracking({containerSelector:".abcSpan3.mostwatched.layout-blocklist",itemSelector:"ol > li"},a)})["catch"](function(a){console.error(a)}).then(function(){$(".abcSpan3.mostwatched.layout-blocklist h3").removeClass("recommendations-loading")}),$("#opinion").addClass("recommendations-loading"),ABC.Recommendations.fetchModule({moduleid:"abc-homepage-analysis-and-opinion",modulecontext:"null",containerSelector:"#opinion",itemSelector:".article",timeout:5e3}).then(function(a){var b=a.recommendations.length;if(b>0){var d=0;$.each(a.recommendations,function(b,e){if(e.metadata){var f=e.metadata;if(d<1){var g='<div id="opinion" class="opinion section layout-tiles recommendations-loading"><h2>'+a.modulelabel+'</h2><div class="abcRow analysis-opinion-items"></div></div>';$('#skiplinks a[href$="opinion"]').first().text(a.modulelabel),$("#opinion").replaceWith(g)}var h='<div class="article abcSpan3" data-contentid="'+e.snowplow.contentid+'"><a href="'+f.canonicalURL+'"><h3>'+f.titleAlt.md+'</h3><img width="220" height="124" src="'+c(f._embedded.mediaThumbnail.images["16x9"])+'" alt="'+f.byLine+'"><cite>'+f.byLine+"</cite></a></div>";$("#opinion .analysis-opinion-items").append(h),d++}}),$("#opinion a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)}),ABC.Recommendations.applyTracking({containerSelector:"#opinion",itemSelector:".article"},a)}else a.snowplow.contentsource="unknown",a.snowplow.contenttype="unknown",ABC.Recommendations.applyTracking({containerSelector:"#opinion",itemSelector:".article"},a)})["catch"](function(a){console.error(a)}).then(function(){$("#opinion").removeClass("recommendations-loading")}),$("#iviewHighlights").addClass("recommendations-loading"),ABC.Recommendations.fetchModule({moduleid:"abc-homepage-iview-highlights",modulecontext:"null",containerSelector:"#iviewHighlights",itemSelector:".article",removeOnFail:!1}).then(function(c){var e=c.recommendations.length-1;if(e>0){var f=$("#iviewHighlights").clone();$("#iviewHighlights").append('<h2 class="tabHeading">'+c.modulelabel+'</h2><div class="abcRow streamingLinks">   <a class="abcSpan6 watchABClive" href="http://iview.abc.net.au/programs/abc-live-stream/IV1512H001S00"><span>Watch ABC Live on iview</span></a>   <a class="abcSpan6 watchNews24live" href="http://iview.abc.net.au/programs/abc-news-24/NS1413V001S00"><span>Watch NEWS Live on iview</span></a></div><div class="iviewHighlightsRow abcRow"></div>'),$.each(c.recommendations,function(a,b){$(".iviewHighlightsRow").append('<div class="article abcSpan3"></div>')}),ABC.Recommendations.applyTracking({containerSelector:"#iviewHighlights",itemSelector:".article"},c),$(".iviewHighlightsRow .article").each(function(c,g){var h=$(g),i=h.attr("data-contentid");d(i,function(d,i){if(d)g.remove(),$(".iviewHighlightsRow .article").length<1&&$("#iviewHighlights").replaceWith(f);else{var j=i.title?i.title:"";h.append('<a href="'+i.share+'"><img src="'+b(i.thumbnail,220)+'" alt="'+i.title+'" /><h3>'+i.seriesTitle+"</h3>"+(j?"<h4>"+j+"</h4>":"")+"<p>"+a(i.description,150)+"</p></a>"),c>=e&&$(".iviewHighlightsRow a").each(function(a,b){ABC.Homepage.setWebtrendsLinkParameters(b)})}})})}else window.setTimeout(function(){ABC.Homepage.Highlights.loadiviewHighlights(!0),window.setTimeout(function(){$("#iviewHighlights").removeClass("recommendations-loading"),c.snowplow.contentsource="unknown",c.snowplow.contenttype="unknown",ABC.Recommendations.applyTracking({containerSelector:"#iviewHighlights",itemSelector:".article"},c)},250)},250)})["catch"](function(a){console.error(a),ABC.Homepage.Highlights.loadiviewHighlights(!0)}).then(function(){$("#iviewHighlights").removeClass("recommendations-loading")})}();